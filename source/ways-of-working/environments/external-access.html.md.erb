---
title: External Access in Demo
last_reviewed_on: 2022-03-30
review_in: 6 months
weight: 10
---

# <%= current_page.data.title %>

The demo environment is used to demonstrate new features to external stakeholders. 

For guidance on how to deploy an application to the demo environment, see [Common Pipeline](https://hmcts.github.io/ways-of-working/common-pipeline/common-pipeline.html#building-infrastructure-in-the-demo-environment).

There are three different ways in which an application in demo can be made available to external users. This is dependent on the ingress class used in your application.

[Traefik](https://traefik.io/traefik/) is used as the ingress controller in HMCTS applications.

The following traefik instances are available to use:

| IngressClass | Default | Application configuration |
|-|-|-|
| traefik | Yes | Application will be reachable externally without VPN. End user will be required to authenticate to Azure AD before being redirected to the application |
| traefik-private | No | Application will be available over VPN only |
| traefik-no-proxy | No | Application will be reachable externally without VPN or authentication |

### Protecting applications with Azure AD authentication
    
To ensure end users must authenticate to Azure AD before they can view the application in their web browser, you must also set the `enableOAuth` flag to `true`

```yaml
nodejs:
  ingressClass: traefik
  disableTraefikTls: false
  enableOAuth: true
```

#### Getting access to HMCTS Demo Azure AD tenant

*If you are not currently a member of the HMCTS Demo Azure AD tenant, check with your team to see if anyone else is. Everyone in this tenant has permission to invite others.*

#### Adding a redirect URI

<%= warning_text('Review section above on Getting access to HMCTS Demo Azure AD tenant before continuing')%>

The authentication with Azure AD is handled by an Azure AD App Registration in the [HMCTS Demo Azure AD tenant](https://portal.azure.com/hmctsexecdemo.onmicrosoft.com). To allow end users to be authenticated to your application, you must add a redirect URI for your application to the Azure AD App Registration.

There are separate Azure AD App Registrations for CFT and SDS:

- [CFT](https://portal.azure.com/hmctsexecdemo.onmicrosoft.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/Authentication/appId/fbf4cb6e-f09d-4fc4-89fa-b94cb582cb18/isMSAApp/)
- [SDS](https://portal.azure.com/hmctsexecdemo.onmicrosoft.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/Authentication/appId/2a3f8b5a-ec0e-470d-b979-fc79d3e74cba/isMSAApp/)

To add a new redirect URI, navigate to the appropriate app registration in the Azure Portal by clicking on one of the links above.

Click on `Authentication` and click `Add URI` under `Redirect URIs`.

Your redirect URI should be the full URI of your application appended with `/oauth-proxy/callback` e.g. https://toffee.demo.platform.hmcts.net/oauth-proxy/callback

### Protecting applications with HMCTS VPN

If you want your application to only be available on VPN, you must specify the `traefik-private` ingressClass.

You do not need to specify the `enableOAuth` flag in this case.

```yaml
nodejs:
    ingressClass: traefik-private
    disableTraefikTls: false
```

### Making applications externally reachable without VPN or authentication

<%= warning_text('This should only be done for applications that do not work with Azure AD authentication or VPN')%>

If you want your application to only be available without VPN and Azure AD authentication, you must specify the `traefik-no-proxy` ingressClass.

You do not need to specify the `enableOAuth` flag in this case.

```yaml
nodejs:
    ingressClass: traefik-no-proxy
    disableTraefikTls: false
```

### Examples

|  Application GitHub | IngressClass | Application URL | Note |
|-|-|-|-|
| [toffee-frontend](https://github.com/hmcts/sds-flux-config/blob/master/k8s/namespaces/toffee/toffee-frontend/demo/demo.yaml) | traefik | [toffee-frontend](https://toffee.demo.platform.hmcts.net) | Open link in private browsing mode |
| [toffee-recipes-service](https://github.com/hmcts/sds-flux-config/blob/master/k8s/namespaces/toffee/toffee-recipe-backend/demo/demo.yaml) | traefik-private | [toffee-recipes-service](https://toffee-recipe-backend.demo.platform.hmcts.net) | Connect to VPN first |
| [pip-frontend](https://github.com/hmcts/sds-flux-config/blob/master/k8s/namespaces/pip/pip-frontend/patches/demo/pip-frontend.yaml) | traefik-no-proxy | [pip-frontend](https://pip-frontend.demo.platform.hmcts.net/) |  |
