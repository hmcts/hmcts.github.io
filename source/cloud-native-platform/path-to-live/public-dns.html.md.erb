---
title: Public DNS
last_reviewed_on: 2023-10-30
review_in: 6 months
weight: 3
---

# <%= current_page.data.title %>

## External DNS

We use [Azure DNS](https://azure.microsoft.com/en-gb/services/dns/) for managing our public DNS.

The DNS is self-service, managed in the
[azure-public-dns](https://github.com/hmcts/azure-public-dns/tree/master/environments) repository,
follow the [shuttering](shutter.html#pre-requisite) instructions for which records you need to add
for a new service.

## Pipeline testing

Jenkins pipelines run automated tests against your application in preview/dev by connecting to your application by it's private IP address, bypassing Azure Front Door.

A tool called External DNS is deployed to the preview and dev clusters to automatically add DNS records to private DNS zones to allow Jenkins pipelines to run the automated tests.

If you wish for these tests to be conducted through Azure Front Door, add a CNAME record in the [public DNS repo](https://github.com/hmcts/azure-public-dns/tree/master/environments) that points your application to the front door.

Also, add an annotation to your application's ingress controller to tell External DNS to not create DNS records for it.

```
ingressAnnotations:
  external-dns.alpha.kubernetes.io/exclude: "true"
```

## Setup required for an application
- Copy the FrontDoor endpoint hostname for the environment:

<%= partial 'front-door-endpoints' %>

- Clone the [Azure Public DNS](https://github.com/hmcts/azure-public-dns) repository.
- Under environments directory there are yaml files depicting environments that represents zones corresponding to each environment.
There can be multiple zones in one environment,
- Create afdverify CNAME records in the appropriate zone file for environments.
Here is an example [Pull Request](https://github.com/hmcts/azure-public-dns/pull/1387/files),
- Create a PR with records as per the below convention
(make sure you replace the variables with the correct values).


```
- name: "${name}"
  ttl: 300
  record: "{copy endpoint hostname from frontdoor}"
```

Where:

`${name}` =  Identifier that will be used to create endpoints and hosts entries in Frontdoor and CDN profiles.
This should be the `name` attribute from env.tfvars file e.g. [name attribute](https://github.com/hmcts/azure-platform-terraform/blob/fa598ca88221555abcbe54a52f0738ca20d48f59/environments/prod.tfvars#L17)

Send the PR for review to the [Platform Operations](https://hmcts-reform.slack.com/app_redirect?channel=platops-code-review) team. Once the PR is merged terraform will create appropriate records.
