---
title: "Step 9: Configure DNS"
last_reviewed_on: 2025-12-03
review_in: 6 months
weight: 9
---

# <%= current_page.data.title %>

In this step, you will complete your VPN configuration by setting up your DNS settings.
This will allow you to resolve platform-specific Crime domains when connected to the VPN, such as:

- [Jenkins](https://build.mdv.cpp.nonlive/)
- [Gerrit Code Review](https://codereview.mdv.cpp.nonlive/)

Detailed guidance is also available [in this document](https://tools.hmcts.net/confluence/spaces/DATS/pages/1597739711/Crime+VPN+Gerrit+Access+Setup+In+Simple+Steps#CrimeVPN&GerritAccess&SetupInSimpleSteps-TestVPNConnectionSuccessful(justvalidatingthestepdonepreviously))

### Prerequisites

- You should have your Tunnelblick VPN mostly configured from [Step 8](08-vpn-config.html)

---

## Configure DNS

DNSmasq is used as a local DNS server that forwards queries to upstream DNS servers when you are connected to the VPN.

### Option A: Use self-service script (Recommended)








### DNS Challenge

When using the VPN, you need to route DNS queries to the platform''s DNS servers. This is done using dnsmasq.

### Option A: Self-Service Script (Recommended)

[Link to setup repo script]

Run the script to automatically configure dnsmasq:

```bash
[command to run script]
```

The script will:
- [ ] Install dnsmasq
- [ ] Create configuration from template
- [ ] Set up macOS to use local DNS

### Option B: Manual Configuration

#### Install dnsmasq

```bash
brew install dnsmasq
```

#### Create Configuration

[Link to dnsmasq template in setup repo]

1. Copy the template
2. Update with your specific DNS settings:
   - [Placeholder: DNS server 1]
   - [Placeholder: DNS server 2]
   - [Placeholder: Domain mappings]
3. Save to `/usr/local/etc/dnsmasq.conf`

#### Start dnsmasq

```bash
sudo brew services start dnsmasq
```

#### Configure macOS DNS Settings

1. Open System Preferences ‚Üí Network
2. Select your active connection (Wi-Fi or Ethernet)
3. Advanced ‚Üí DNS
4. Add DNS server: `127.0.0.1`
5. Click OK

<details>
<summary>üìã View screenshots: DNS configuration</summary>

[Placeholder for screenshots showing:
- macOS network settings location
- DNS server addition
- Network settings confirmation]

</details>

### Optional: DNS Switching Alias

Create a shell alias to quickly switch between platform DNS and default DNS:

```bash
# Add to your ~/.zshrc file
alias use-platform-dns="sudo scutil <<< 'open\nget State:/Network/Global/IPv4\nd.146.2.132.1 127.0.0.1 192.168.1.1\nset State:/Network/Global/IPv4\nquit'"
alias use-default-dns="sudo scutil <<< 'open\nget State:/Network/Global/IPv4\nd.146.2.132.1 192.168.1.1\nset State:/Network/Global/IPv4\nquit'"
```

Then reload your shell:

```bash
source ~/.zshrc
```

<details>
<summary>üìã View DNS switching details</summary>

[Placeholder: Detailed DNS switching documentation]

</details>

---

## Important: Disable Global Protect

‚ö†Ô∏è If you have Global Protect VPN installed from previous roles:

1. Open Global Protect
2. Disconnect and disable
3. Remove from startup items
4. The Tunnelblick VPN should be your only active VPN

Having multiple VPN clients active simultaneously will cause connection issues.

---

## Test Your VPN Connection

1. Open Tunnelblick
2. Select "crime-platform" (or your configuration name)
3. Click "Connect"
4. You should see a connected status within [Placeholder: X seconds]

**Successful connection indicators:**
- [ ] Green connection icon in Tunnelblick
- [ ] System notifications show VPN connected
- [ ] Your local IP shows in VPN details

<details>
<summary>üìã View screenshot: Successful VPN connection</summary>

[Placeholder for screenshot]

</details>

---

## Summary Checklist

- ‚úì Tunnelblick installed
- ‚úì VPN configuration created and imported
- ‚úì dnsmasq installed and configured
- ‚úì macOS DNS set to 127.0.0.1
- ‚úì Global Protect disabled
- ‚úì Successfully connected to VPN

---

**Next step:** [Step 8: Configure SSH](08-ssh-config.html)

[‚Üê Back to onboarding overview](index.html)
