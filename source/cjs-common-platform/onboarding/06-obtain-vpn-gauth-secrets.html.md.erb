---
title: "Step 6: Obtain VPN and authenticator secrets"
last_reviewed_on: 2025-12-03
review_in: 6 months
weight: 6
---

# <%= current_page.data.title %>

In this step, you will retrieve and decrypt two important secrets:

1. **Google Authenticator secret** - For two-factor authentication required when SSHing or pulling from Gerrit
2. **OpenVPN secret** - OVPN profile you must use to connect to the Crime VPN using Tunnelblick

Both secrets are stored in Azure Key Vault encrypted with your GPG key.

### Option A: Self-Service Script (Recommended)

If you have `az-cli` installed you can use the self-service script to automate the retrieval and decryption process.

[The scripts lives in the setup repository you already used in previous steps](https://github.com/hmcts/cpp-terraform-azurerm-azuread/blob/main/self-service/get-secrets.sh).

This script uses `az cli` and `gpg` utilities to automate the whole process, run:

```bash
> ./self-service/get-secrets.sh
# username: demo.user
# environment: non-live or live
# path: desired path to save the decrypted secrets - keep this safe!
```

The script will:

- Ask you to authenticate into your Crime Azure Portal account by opening a new browser window
- Query Azure Key Vault for your secrets
- Download and decode the secrets from base64 into `*.gpg` files
- Decrypt the `*.gpg` secret files into plaintext `*.decrypted` files using your private key

---

### Option B: Manual Retrieval from Azure Portal

**Navigate to Azure Portal:**

1. Open [https://portal.azure.com/](https://portal.azure.com/)
2. Search for "Key Vault" in the search bar
3. Find the appropriate Key Vault for your environment:
   - Non-Live: `hmcts-jml-kv-mdv`
   - Live: `hmcts-jml-kv-mpd`
4. Under "Secrets", find your user entry
5. Click your user secret
6. Click "Show Secret Value" to reveal the encrypted secret
7. Click "Copy to clipboard" to copy the entire encrypted content

<details>
<summary>üìã View screenshot: Find the Azure Key Vault</summary>

<img src="/images/find-jml-keyvault.png" alt="Azure Key Vault resource"/>

</details>

<details>
<summary>üìã View screenshot: View list of secrets</summary>

<img src="/images/find-jml-secret.png" alt="Azure Key Vault secrets list"/>

</details>

<details>
<summary>üìã View screenshot: View your secret</summary>

<img src="/images/view-jml-secret.png" alt="Azure Key Vault secret display"/>

</details>

</br>

**Save, decode and decrypt secrets:**

1. Save both secrets you copied into separate text files:
   - `gauth-secret.b64.txt` for Google Authenticator secret
   - `openvpn-secret.b64.txt` for OpenVPN secret

2. Decode from base64:

      ```bash
      cat gauth-secret.b64.txt | base64 --decode > gauth-secret.gpg
      cat openvpn-secret.b64.txt | base64 --decode > openvpn-secret.gpg
      ```

3. Decrypt to plaintext:

      ```bash
      gpg --decrypt gauth-secret.gpg > gauth-secret.txt
      gpg --decrypt openvpn-secret.gpg > openvpn-secret.ovpn
      ```

---

## Summary Checklist

‚úì **Retrieved authenticator secret from Azure Key Vault**

‚úì **Retrieved OpenVPN secret from Azure Key Vault**

‚úì **Decoded secrets from base64**

‚úì **Decrypted secrets using GPG**

```bash
> ls
demo.user_ovpn_secret.decrypted
demo.user_google_authenticator_secret.decrypted
```

---

**Next step:** [Step 7: Configure Google Authenticator](07-configure-google-auth.html)

[‚Üê Back to onboarding overview](index.html)
