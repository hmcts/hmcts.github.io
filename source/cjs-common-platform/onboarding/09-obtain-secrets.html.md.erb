---
title: "Step 9: Obtain Secrets"
last_reviewed_on: 2025-12-03
review_in: 6 months
weight: 9
---

# <%= current_page.data.title %>

In this step, you'll retrieve and decrypt two important secrets:
1. **Google Authenticator secret** - For two-factor authentication
2. **OpenVPN secret** - For VPN connection authentication

Both secrets are stored in Azure Key Vault encrypted with your GPG key.

## Option A: Self-Service Script (Recommended)

[Link to setup repo script]

This script automates the entire process:

```bash
[command to run script]
```

The script will:
- [ ] Query Azure Key Vault for your secrets
- [ ] Decrypt using your GPG key
- [ ] Display Google Authenticator QR code
- [ ] Guide you through configuration

Skip to [Configure Google Authenticator](#configure-google-authenticator) after running the script.

---

## Option B: Manual Retrieval

### Prerequisites

Ensure you have:
- [ ] Azure CLI installed and authenticated
- [ ] Access to Azure Key Vault
- [ ] Your GPG key available

### Step 1: Retrieve from Azure Portal

Navigate to Azure Portal:

1. Open [https://portal.azure.com/](https://portal.azure.com/)
2. Search for "Key Vault" in the search bar
3. Select the appropriate Key Vault for your environment:
   - [Placeholder: Non-live vault name]
   - [Placeholder: Live vault name]
4. Under "Secrets", find your user entry
5. Click your user secret

<details>
<summary>üìã View screenshot: Azure Key Vault secret location</summary>

[Placeholder for screenshots showing:
- Key Vault search
- Secrets list
- Secret selection]

</details>

### Step 2: Copy Encrypted Secret

1. Click "Show Secret Value"
2. Copy the entire encrypted content (it will start with `-----BEGIN PGP MESSAGE-----`)
3. Save to a temporary file: `secrets.gpg`

### Step 3: Alternative - Use Azure CLI

```bash
# List available secrets
az keyvault secret list --vault-name [vault-name] --query '[].name'

# Get your secret
az keyvault secret show --vault-name [vault-name] --name [your-username] --query 'value' -o tsv > secrets.gpg
```

### Step 4: Decrypt Your Secrets

```bash
# Decrypt the file
gpg --decrypt secrets.gpg
```

Enter your GPG passphrase when prompted.

The output will contain both secrets in this format:

```
Google Authenticator Secret: [SECRET_STRING]
OpenVPN Secret: [SECRET_STRING]
```

<details>
<summary>üìã View decryption process details</summary>

[Placeholder: Detailed decryption steps with examples]

</details>

---

## Configure Google Authenticator

### Install Authenticator App

Choose an authenticator application:
- **Recommended:** Microsoft Authenticator or Google Authenticator
- **Alternatives:** Authy, 1Password, or any TOTP-compatible app

### Add Your Secret

You have two options:

#### Option A: QR Code (Easier)

If you ran the self-service script, you should see a QR code on screen:

1. Open your authenticator app
2. Select "Add account" or "Scan QR code"
3. Scan the displayed QR code
4. Your account will appear in the app

#### Option B: Manual Entry

If you have the secret string:

1. Open your authenticator app
2. Select "Add account" or "Manual entry"
3. Enter:
   - **Account name:** [Placeholder: account-name]
   - **Secret key:** [Your Google Authenticator secret from decryption]
   - **Type:** Time-based (TOTP)
4. Your account will appear in the app

<details>
<summary>üìã View screenshots: Adding account to authenticator app</summary>

[Placeholder for screenshots showing:
- App add account screen
- QR code scanning
- Manual entry
- Successful account addition]

</details>

### Verification

After adding your account:

- [ ] Your account appears in the authenticator app
- [ ] App displays a 6-digit code that changes every 30 seconds
- [ ] Code is displayed next to your account name

You'll use this code during [Step 10: Validation](#).

---

## Save OpenVPN Secret

The OpenVPN secret is used in your VPN configuration:

1. Copy your OpenVPN secret from the decrypted output
2. Store securely (password manager or encrypted storage)
3. You may need it for VPN configuration if not already set up

‚ö†Ô∏è **Do not store in plain text files in your home directory**

---

## Verify Both Secrets

Before proceeding, confirm you have:

- ‚úì Google Authenticator secret added to app (shows 6-digit code)
- ‚úì OpenVPN secret saved securely
- ‚úì Both secrets are decrypted and readable

---

## Summary Checklist

- ‚úì Retrieved secrets from Azure Key Vault
- ‚úì Decrypted secrets using GPG key
- ‚úì Added Google Authenticator to your app
- ‚úì OpenVPN secret stored securely

---

**Next step:** [Step 10: Validation](10-validation.html)

[‚Üê Back to onboarding overview](index.html)
